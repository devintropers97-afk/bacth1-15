ğŸ”· BATCH 7: ADMIN PANEL - ORDER & PAYMENT MANAGEMENT
Priority: HIGH | Files: ~55 | Duration: Test 3-4 hari
ğŸ“‚ Files to Create:
/admin/
â”œâ”€â”€ /orders/
â”‚   â”œâ”€â”€ index.php                 # All orders list
â”‚   â”œâ”€â”€ pending.php               # Pending orders
â”‚   â”œâ”€â”€ paid.php                  # Paid orders (waiting to process)
â”‚   â”œâ”€â”€ in-progress.php           # Orders in progress
â”‚   â”œâ”€â”€ completed.php             # Completed orders
â”‚   â”œâ”€â”€ cancelled.php             # Cancelled orders
â”‚   â”œâ”€â”€ view.php                  # Order detail
â”‚   â”œâ”€â”€ edit.php                  # Edit order
â”‚   â”œâ”€â”€ update-status.php         # Update order status
â”‚   â”œâ”€â”€ assign-to-partner.php     # Assign order to partner (for execution)
â”‚   â”œâ”€â”€ cancel.php                # Cancel order
â”‚   â”œâ”€â”€ refund.php                # Process refund
â”‚   â”œâ”€â”€ timeline.php              # Order timeline visualization
â”‚   â”œâ”€â”€ bulk-update.php           # Bulk status update
â”‚   â””â”€â”€ export.php                # Export orders
â”‚
â”œâ”€â”€ /payments/
â”‚   â”œâ”€â”€ index.php                 # All payments list
â”‚   â”œâ”€â”€ pending-verification.php  # Pending payment verifications â­
â”‚   â”œâ”€â”€ verify-payment.php        # Verify payment (approve/reject) â­
â”‚   â”œâ”€â”€ verified.php              # Verified payments
â”‚   â”œâ”€â”€ rejected.php              # Rejected payments
â”‚   â”œâ”€â”€ view-proof.php            # View payment proof (image viewer)
â”‚   â”œâ”€â”€ bulk-verify.php           # Bulk verification
â”‚   â”œâ”€â”€ reminders.php             # Send payment reminders
â”‚   â”œâ”€â”€ statistics.php            # Payment statistics
â”‚   â””â”€â”€ export.php                # Export payments
â”‚
â”œâ”€â”€ /invoices/
â”‚   â”œâ”€â”€ index.php                 # All invoices
â”‚   â”œâ”€â”€ generate.php              # Generate invoice
â”‚   â”œâ”€â”€ view.php                  # View invoice (PDF preview)
â”‚   â”œâ”€â”€ download.php              # Download invoice PDF
â”‚   â”œâ”€â”€ send-email.php            # Send invoice via email
â”‚   â”œâ”€â”€ edit-template.php         # Edit invoice template
â”‚   â”œâ”€â”€ unpaid.php                # Unpaid invoices
â”‚   â”œâ”€â”€ overdue.php               # Overdue invoices
â”‚   â””â”€â”€ bulk-send.php             # Bulk email invoices
â”‚
â”œâ”€â”€ /subscriptions/
â”‚   â”œâ”€â”€ index.php                 # All subscriptions
â”‚   â”œâ”€â”€ active.php                # Active subscriptions
â”‚   â”œâ”€â”€ expiring.php              # Expiring soon (7 days)
â”‚   â”œâ”€â”€ expired.php               # Expired subscriptions
â”‚   â”œâ”€â”€ cancelled.php             # Cancelled subscriptions
â”‚   â”œâ”€â”€ view.php                  # Subscription detail
â”‚   â”œâ”€â”€ renew.php                 # Manually renew subscription
â”‚   â”œâ”€â”€ cancel.php                # Cancel subscription
â”‚   â”œâ”€â”€ send-reminder.php         # Send renewal reminder
â”‚   â”œâ”€â”€ payment-history.php       # Subscription payment history
â”‚   â”œâ”€â”€ statistics.php            # Subscription analytics
â”‚   â””â”€â”€ monitor-stops.php         # Monitor <3 month stops â­
â”‚
â”œâ”€â”€ /refunds/
â”‚   â”œâ”€â”€ index.php                 # All refund requests
â”‚   â”œâ”€â”€ pending.php               # Pending refund approval
â”‚   â”œâ”€â”€ approve-refund.php        # Approve refund
â”‚   â”œâ”€â”€ reject-refund.php         # Reject refund
â”‚   â”œâ”€â”€ processed.php             # Processed refunds
â”‚   â””â”€â”€ statistics.php            # Refund statistics
â”‚
â””â”€â”€ /commission-triggers/          # ğŸ†• Auto-commission system
    â”œâ”€â”€ payment-approved.php      # Triggered when payment approved
    â”œâ”€â”€ calculate-commission.php  # Calculate partner/SPV/Manager commission
    â”œâ”€â”€ distribute-commission.php # Distribute to all levels
    â”œâ”€â”€ commission-log.php        # Commission calculation log
    â””â”€â”€ manual-trigger.php        # Manual commission recalculation

/controllers/admin/
â”œâ”€â”€ OrderController.php
â”œâ”€â”€ PaymentController.php
â”œâ”€â”€ InvoiceController.php
â”œâ”€â”€ SubscriptionController.php
â”œâ”€â”€ RefundController.php
â””â”€â”€ CommissionTriggerController.php

/models/
â”œâ”€â”€ OrderManagement.php
â”œâ”€â”€ PaymentManagement.php
â”œâ”€â”€ Invoice.php
â”œâ”€â”€ InvoiceTemplate.php
â”œâ”€â”€ Subscription.php
â”œâ”€â”€ SubscriptionPayment.php
â”œâ”€â”€ Refund.php
â””â”€â”€ CommissionTrigger.php

/includes/admin/
â”œâ”€â”€ order-status-badge.php        # Order status badge component
â”œâ”€â”€ payment-proof-viewer.php      # Payment proof modal viewer
â”œâ”€â”€ invoice-preview.php           # Invoice preview modal
â””â”€â”€ commission-breakdown.php      # Commission breakdown display

/assets/js/
â”œâ”€â”€ order-management.js           # Order CRUD operations
â”œâ”€â”€ payment-verification.js       # Payment verification UI
â”œâ”€â”€ invoice-generator.js          # Invoice generation
â”œâ”€â”€ subscription-monitor.js       # Subscription monitoring
â””â”€â”€ commission-calculator.js      # Commission calculation UI

/cron/
â”œâ”€â”€ send-payment-reminders.php    # Daily: Send payment reminders
â”œâ”€â”€ send-renewal-reminders.php    # Daily: Send subscription renewal reminders
â”œâ”€â”€ mark-overdue-invoices.php     # Daily: Mark overdue invoices
â”œâ”€â”€ auto-cancel-expired.php       # Daily: Cancel expired subscriptions
â””â”€â”€ commission-reconciliation.php # Weekly: Reconcile all commissions
âœ… Features Completed:
Order Management:

âœ… Order List with Filters:

All orders datatable
Filter by status (pending, paid, in-progress, completed, cancelled)
Filter by order type (beli putus, sewa bulanan)
Filter by date range
Search by order number, client name
Sort by date, amount, status


âœ… Order Detail Page:

Order information (number, date, type, amount)
Client information
Partner information (referred by)
Service details & customization
Payment status
Order timeline (ordered â†’ paid â†’ in-progress â†’ completed)
Assigned partner (for execution)
Status history with timestamps
Admin notes (internal)


âœ… Order Status Management:

Update status manually
Pending â†’ Paid (after payment verification)
Paid â†’ In Progress (work started)
In Progress â†’ Completed (delivered)
Any â†’ Cancelled (with reason)
Auto email notification on status change


âœ… Assign to Partner:

Assign order execution to available partner
Job board integration
Track assigned jobs
Monitor completion


âœ… Bulk Operations:

Bulk status update
Bulk assignment
Bulk export


âœ… Order analytics & reporting

Payment Management:

âœ… Pending Payment Verification (CRITICAL):

List of payments awaiting verification
Display payment proof (image/screenshot)
Payment method (bank transfer/QRIS)
Payment amount & order details
Verify Payment Actions:

âœ… APPROVE:

Mark payment as verified
Update order status to "Paid"
TRIGGER AUTO-COMMISSION CALCULATION:

Get order amount
Get partner tier
Calculate partner commission (30-55%)
If partner has SPV: Calculate SPV commission (10%)
If SPV has Manager: Calculate Manager commission (5%)
Insert commissions into partner_commissions table
Update partner available balance
Send commission earned email to partner
If SPV: Send commission earned email to SPV
If Manager: Send commission earned email to Manager


Generate invoice
Send payment confirmation email to client
Send order received email to client


âŒ REJECT:

Mark payment as rejected
Provide rejection reason
Send rejection email to client
Payment stays pending






âœ… Payment Proof Viewer:

Lightbox image viewer
Zoom in/out
Download proof
Compare with bank statement


âœ… Bulk Verification:

Approve multiple payments at once
Reject multiple payments
Auto-commission for bulk approvals


âœ… Payment Statistics:

Total payments (today, this month, all time)
Payment method breakdown
Average payment amount
Payment success rate
Pending payment count


âœ… Payment Reminders:

Auto-send reminder after 24 hours
Manual reminder sending
Reminder template customization



Invoice Management:

âœ… Invoice Generation:

Auto-generate on payment verification
Invoice format: INV-SITUNEO-DD-MMM-YYYY-XXXXX
Example: INV-SITUNEO-15-NOV-2025-00123


âœ… Invoice Template:

Company header (logo, name, address, NIB, NPWP)
Client details
Order details & breakdown
Subtotal, discount, tax (if applicable), total
Payment method
Terms & conditions
Footer (bank accounts, contact)
Professional design (PDF generation)


âœ… Invoice Actions:

View invoice (PDF preview)
Download invoice (PDF download)
Send via email
Regenerate invoice
Edit invoice template (admin only)


âœ… Invoice Status:

Unpaid
Paid
Overdue (auto-mark after due date)
Cancelled


âœ… Bulk Invoice Operations:

Bulk email sending
Bulk download (ZIP)
Bulk mark as paid



Subscription Management:

âœ… Active Subscriptions:

List all active subscriptions
Client info
Subscription plan
Monthly amount
Start date
Next billing date
Auto-renew status
Total months subscribed â­


âœ… Expiring Subscriptions:

Subscriptions expiring in 7 days
Auto-send renewal reminder
One-click renewal


âœ… Subscription Stop Monitor (CRITICAL):

Track all stopped/cancelled subscriptions
Check 3-month rule:

If subscribed < 3 months:
â†’ Flag for auto-deduct
â†’ Show partner who will be affected
â†’ Show deduction amount
â†’ Option to give partner follow-up chance (7 days)
â†’ If no follow-up or failed: Auto-deduct commission


Manual override (admin can waive penalty)
Deduction history tracking


âœ… Subscription Renewal:

Auto-renew (if enabled)
Manual renewal (admin can renew manually)
Renewal reminders (email + notification)


âœ… Subscription Cancellation:

Client requests cancellation
Admin processes cancellation
Check 3-month rule
Apply penalty if needed
Send cancellation confirmation


âœ… Subscription Analytics:

Active subscription count
MRR (Monthly Recurring Revenue)
Churn rate
Renewal rate
Average subscription duration



Refund Management:

âœ… Refund request list
âœ… Approve/reject refund
âœ… Refund reasons tracking
âœ… Partial refund support
âœ… Refund to original payment method
âœ… Commission reversal on refund
âœ… Refund statistics

Auto-Commission System (CRITICAL):

âœ… Trigger on Payment Approval:

  When admin approves payment:
  1. Get order details (amount, partner_id)
  2. Get partner tier (30%, 40%, 50%, 55%)
  3. Calculate partner commission
  4. Check if partner has SPV:
     - Yes: Calculate SPV commission (10% of order)
     - Check if SPV has Manager:
       - Yes: Calculate Manager commission (5% of order)
  5. Insert commissions into database
  6. Update balances
  7. Send email notifications
  8. Log commission calculation

âœ… Commission Breakdown Display:

Show commission distribution per order
Partner: Rp XXX (XX%)
SPV: Rp XXX (10%)
Manager: Rp XXX (5%)
SITUNEO: Rp XXX (remaining)


âœ… Manual Trigger:

Recalculate commission (if error)
Adjust commission manually
Commission reconciliation tool


âœ… Commission Log:

Track all commission calculations
Audit trail
Error logging



ğŸ§ª Testing Checklist:

 Order list displays correctly
 Can update order status
 Status change sends email
 Can assign order to partner
 Payment verification page works
 Can approve payment
 Auto-commission triggers on payment approval
 Commission calculates correctly (Partner/SPV/Manager)
 Commission emails sent to all recipients
 Can reject payment
 Payment proof viewer works
 Invoice generates correctly
 Invoice PDF downloads
 Invoice email sends
 Subscription list accurate
 Expiring subscriptions show correctly
 Renewal reminders send
 Subscription stop monitor works
 <3 month rule triggers correctly
 Auto-deduct processes properly
 Refund approval works
 Commission reversal on refund
 Bulk operations functional
