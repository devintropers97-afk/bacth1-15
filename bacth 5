ðŸ”· BATCH 5: PARTNER DASHBOARD - ADVANCED + SUBSCRIPTION AUTO-DEDUCT
Priority: HIGH | Files: ~40 | Duration: Test 2-3 hari
ðŸ“‚ Files to Create:
/partner/
â”œâ”€â”€ /penalties/
â”‚   â”œâ”€â”€ index.php                 # Penalties overview
â”‚   â”œâ”€â”€ subscription-stops.php    # Auto-deduct tracking
â”‚   â”œâ”€â”€ late-deliveries.php       # Late delivery penalties
â”‚   â”œâ”€â”€ quality-issues.php        # Quality-based penalties
â”‚   â””â”€â”€ appeal.php                # Appeal penalty (future)
â”‚
â”œâ”€â”€ /notifications/
â”‚   â”œâ”€â”€ index.php                 # All notifications
â”‚   â”œâ”€â”€ commission-alerts.php     # Commission notifications
â”‚   â”œâ”€â”€ withdrawal-updates.php    # Withdrawal status updates
â”‚   â”œâ”€â”€ job-notifications.php     # Job board notifications
â”‚   â””â”€â”€ system-announcements.php  # System-wide announcements
â”‚
â”œâ”€â”€ /leaderboard/                  # ðŸ†• Will be in Batch 8-10
â”‚   â””â”€â”€ preview.php               # Leaderboard preview (read-only)
â”‚
â””â”€â”€ /reports/
    â”œâ”€â”€ monthly-report.php        # Generate monthly report
    â”œâ”€â”€ tax-report.php            # Tax calculation (NPWP)
    â””â”€â”€ export.php                # Export data (CSV, PDF)

/cron/
â”œâ”€â”€ check-subscription-stops.php  # Daily cron: Check stopped subscriptions
â”œâ”€â”€ auto-deduct-commissions.php   # Process auto-deductions
â”œâ”€â”€ calculate-arpu.php            # Monthly ARPU calculation
â”œâ”€â”€ tier-maintenance.php          # Update tiers (never decrease)
â””â”€â”€ bonus-distribution.php        # Distribute SPV/Manager bonuses

/controllers/partner/
â”œâ”€â”€ PenaltyController.php
â”œâ”€â”€ NotificationController.php
â”œâ”€â”€ ReportController.php
â””â”€â”€ SubscriptionMonitorController.php

/models/
â”œâ”€â”€ Penalty.php
â”œâ”€â”€ SubscriptionMonitor.php
â”œâ”€â”€ NotificationPartner.php
â””â”€â”€ PartnerReport.php

/emails/partner/
â”œâ”€â”€ commission-earned.php         # Commission notification
â”œâ”€â”€ withdrawal-approved.php       # Withdrawal approved
â”œâ”€â”€ withdrawal-completed.php      # Transfer completed
â”œâ”€â”€ job-assigned.php              # Job assigned notification
â”œâ”€â”€ job-approved.php              # Job application approved
â”œâ”€â”€ penalty-applied.php           # Penalty notification
â”œâ”€â”€ subscription-stopped.php      # Client subscription stopped
â”œâ”€â”€ tier-upgraded.php             # Tier upgraded notification
â””â”€â”€ bonus-earned.php              # ARPU bonus earned (SPV/Manager)

/api/webhooks/
â”œâ”€â”€ payment-verified.php          # Webhook: Payment verified â†’ Calculate commission
â”œâ”€â”€ subscription-renewed.php      # Webhook: Subscription renewed
â”œâ”€â”€ subscription-cancelled.php    # Webhook: Subscription cancelled â†’ Check 3-month rule
â””â”€â”€ order-completed.php           # Webhook: Order completed
âœ… Features Completed:
Subscription Auto-Deduct System (CRITICAL):

âœ… 3-Month Minimum Rule:

Client MUST subscribe minimum 3 months for partner to keep commission
If client stops before 3 months:
â†’ Auto-deduct commission from partner balance
â†’ Cascade deduction: Partner loses full amount, SPV gets 10%, Manager gets 5%
â†’ If partner balance insufficient: Goes negative (debt)


âœ… Daily Cron Job:

Runs every day at 00:00
Checks all subscriptions
Identifies stopped subscriptions
Calculates months subscribed
If < 3 months: Trigger auto-deduct


âœ… Auto-Deduct Process:

  1. Check if subscription stopped
  2. Calculate subscription duration
  3. If duration < 3 months:
     - Get original commission amount
     - Deduct from partner balance
     - If partner has downline:
       â†’ SPV gets 10% of deducted amount (as compensation)
       â†’ Manager gets 5% of deducted amount (as compensation)
     - If no downline:
       â†’ Partner loses 100%
  4. Send notification to partner
  5. Log penalty in database
  6. Update partner balance

âœ… Negative Balance Handling:

Partner can go negative balance
Future commissions will offset negative balance first
Cannot withdraw until balance is positive
Email notification on negative balance


âœ… Client Follow-Up Alternative:

Instead of auto-deduct, admin can assign follow-up to partner
Partner gets 7 days to convince client to continue
If successful: No deduction
If unsuccessful: Deduction applies



Penalty System:

âœ… Subscription stop penalties (auto-deduct)
âœ… Late delivery penalties (job board)
âœ… Quality issue penalties (admin-initiated)
âœ… Penalty history tracking
âœ… Penalty appeal system (manual review)

Notification System:

âœ… Real-time notifications (in-app)
âœ… Email notifications
âœ… Notification categories:

Commission earned
Withdrawal updates
Job board updates
Penalties applied
Tier changes
Bonus earned
System announcements


âœ… Mark as read/unread
âœ… Notification preferences (email on/off per category)

Reporting:

âœ… Monthly performance report (PDF download)
âœ… Tax report (NPWP-based calculation)
âœ… Commission breakdown report
âœ… Export data (CSV, Excel, PDF)
âœ… Custom date range reports

Cron Jobs:

âœ… Daily subscription monitor
âœ… Monthly ARPU calculation
âœ… Monthly tier updates
âœ… Quarterly bonus distribution (SPV/Manager)

ðŸ§ª Testing Checklist:

 Subscription stop detected correctly
 Auto-deduct calculates accurately
 Cascade deduction works (Partner/SPV/Manager)
 Negative balance displays properly
 Cannot withdraw with negative balance
 Future commissions offset negative balance
 Cron jobs run successfully
 ARPU calculates monthly
 Tier never decreases
 Bonuses distribute correctly
 Notifications sent properly
 Reports generate correctly
 Penalty tracking accurate
